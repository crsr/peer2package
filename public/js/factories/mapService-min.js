(function(){var e;e=angular.module("peer2package"),e.service("mapService",["$rootScope","$geolocation","socket","$interval","userService",function(e,o,t,n,a){var r,i;return e.mapOff=function(e){return n.cancel(e)},e.loading=!0,i=null,r=null,e.$on("$viewContentLoaded",function(){var c;return o.getCurrentPosition({timeout:6e4}).then(function(c){var u,l,s,d,p;if(i=c.coords.longitude,r=c.coords.latitude,e.myPosition=c,e.myInterval=n(function(){o.getCurrentPosition({timeout:6e4}).then(function(o){var n,c,u,d;e.myPosition=o,n=a.currentUser(),i=o.coords.longitude,r=o.coords.latitude,c="http://localhost:8000/user_location",u="http://localhost:8000/other_positions/",d=n.email+", "+i+", "+r,t.emit("LngLat",d),l.setData(c),s.setData(u)})},1e3),mapboxgl.accessToken="pk.eyJ1IjoiamFtZXNhZGlja2Vyc29uIiwiYSI6ImNpbmNidGJqMzBwYzZ2OGtxbXljY3FrNGwifQ.5pIvQjtuO31x4OZm84xycw",document.getElementById("map")&&(u=new mapboxgl.Map({container:"map",style:"mapbox://styles/jamesadickerson/ciq1h3u9r0009b1lx99e6eujf",zoom:19})),d="http://localhost:8000/user_location",p="http://localhost:8000/other_positions",l=new mapboxgl.GeoJSONSource({data:d}),s=new mapboxgl.GeoJSONSource({data:p}),document.getElementById("map"))return u.on("load",function(){return e.loading=!1,u.addSource("You",l),u.addSource("Others",s),u.addLayer({id:"You",type:"symbol",source:"You",layout:{"icon-image":"car"},paint:{}}),u.addLayer({id:"Others",type:"symbol",source:"Others",layout:{"icon-image":"car2"},paint:{}}),u.setCenter([i,r]),console.log(i+","+r),u.on("click",function(e){var o,t,n;if(t=u.queryRenderedFeatures(e.point,{layers:["You"]}),t.length)return o=t[0],n=new mapboxgl.Popup({closeButton:!1}).setLngLat([i,r]).setHTML(o.properties.description).addTo(u)})})}),c=function(){return map.flyTo({center:[i,r]})}})}])}).call(this);
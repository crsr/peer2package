<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no"><title>Document</title><link rel="stylesheet" href="stylesheets/main.css"><script src="../bower_components/angular/angular.js"></script><script src="../bower_components/angular-ui-router/release/angular-ui-router.js"></script><script rel="preload" src="https://api.mapbox.com/mapbox-gl-js/v0.20.1/mapbox-gl.js"></script><link rel="preload" href="https://api.mapbox.com/mapbox-gl-js/v0.20.1/mapbox-gl.css"><script src="../bower_components/socket.io-client/socket.io.js"></script><script>var lat = null;
var lng = null;
var socket = io();

function getLocation() {
	if (navigator.geolocation) {
		navigator.geolocation.getCurrentPosition(showPosition);
	} else {
		x.innerHTML = "Geolocation is not supported by this browser.";
	};
};

function showPosition(position) {
	lat = position.coords["latitude"];
	lng = position.coords["longitude"];
	mapboxgl.accessToken = 'pk.eyJ1IjoiamFtZXNhZGlja2Vyc29uIiwiYSI6ImNpbmNidGJqMzBwYzZ2OGtxbXljY3FrNGwifQ.5pIvQjtuO31x4OZm84xycw';
	var map = new mapboxgl.Map({
		container: 'map',
		style: 'mapbox://styles/jamesadickerson/ciq1h3u9r0009b1lx99e6eujf',
		zoom: 19,
		center: [lng,lat]
	});
	var url = 'http://localhost:8080/user_location';
	var source = new mapboxgl.GeoJSONSource({
		data: url
		});
	window.setInterval(function() {
		navigator.geolocation.getCurrentPosition(function(position) {
			lat = position.coords["latitude"];	
			lng = position.coords["longitude"];
		});
		var yourPosition = lng + ',' + lat;
		socket.emit('LngLat', yourPosition);
		source.setData(url);
		}, 1000);

	map.on('load', function () {
		map.addSource('You', source);
		map.addLayer({
			"id": "You",
			"type": "circle",
			"source": "You",
			"paint": {
				"circle-radius": 20,
				"circle-color": "#E65D5D"
			}
		});
	});

	function moveToPosition () {
		map.flyTo({center: [lng, lat]});	
	}

	map.on('click', function (e) {
		var features = map.queryRenderedFeatures(e.point, { layers: ['You'] });
		if (!features.length) {
			return;
		}
		var feature = features[0];
		var popup = new mapboxgl.Popup()
			.setLngLat(feature.geometry.coordinates)
			.setHTML(feature.properties.description)
			.addTo(map);
	});
	var preloader = document.getElementById('preloader');
	setTimeout(function () {
		preloader.classList.add('hidden'); }, 0					
	);
};

window.onload = function () {
	getLocation();
};</script></head></html><body><style>button#centerMap {
	display:inline-block;
	width:200px;
	height:100px;
	position:absolute;
	right:10px;
	top:400px;
	z-index:9999;
}
</style><div id="preloader" style="position: absolute; top: 0px; left: 0px; right: 0px; bottom: 0px;"><img src="./img/preloader.gif"></div><div id="menu"><img src="./img/hamburger.png"></div><button id="centerMap" onclick="moveToPosition()">Center Move to Position</button><div id="map"></div><script src="js/map.js"></script></body>